<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="test.spring.mvc.repository.SellerSaleMapper">
	
	<!-- 주문 목록 -->
	<select id = "orderproduct" parameterType="test.spring.mvc.bean.OrderdetailDTO">
		select * from all_product ap join OOOO_orderdetail op on ap.companyid || ap.category || ap.category2 || ap.flavor = op.PRODUCTID where companyid = #{companyid}
	</select>
	
	<!-- 송장번호 업데이트 -->
	<update id="updateTrackingAndCourier">
    	update OOOO_orderdetail
	    set tracking = #{tracking}, courier = #{courier}
	    where orderid = #{orderid}  and PRODUCTID like #{companyid}
	</update>
	
	<!-- 오늘 매출액 -->
	<select id = "getTodaySales" resultType="int">
		select sum(price * quantity) as totalSales from OOOO_orderdetail where PRODUCTID like #{companyid}
  		and purchase = 1  and TRUNC(purdate) = TRUNC(SYSDATE)
	</select>
	
	<!-- 일주일 매출액 -->
	<select id = "getWeeklySales" resultType="int">
		select sum(price * quantity) as totalSales from OOOO_orderdetail where PRODUCTID like #{companyid}
  		and purchase = 1 and purdate >= TRUNC(SYSDATE) - 7
	</select>
	
	<!-- 한달 매출액 -->
	<select id = "getMonthlySales" resultType="int">
		select sum(price * quantity) as totalSales from OOOO_orderdetail where PRODUCTID like #{companyid}
	  	and purchase = 1 and purdate >= ADD_MONTHS(TRUNC(SYSDATE), -1)
	</select>
	
	<!-- 오늘 순수익 -->
	<select id = "todayNetSales" resultType="int">
		select sum(price * quantity) - sum(price * quantity * 0.1) as netSales from OOOO_orderdetail 
			where PRODUCTID like #{companyid} and purchase = 1  and TRUNC(purdate) = TRUNC(SYSDATE)
	</select>
	
	<!-- 일주일 순수익 -->
	<select id = "weeklyNetSales" resultType="int">
		select sum(price * quantity) - sum(price * quantity * 0.1) as netSales from OOOO_orderdetail 
		where PRODUCTID like #{companyid}  and purchase = 1  and TRUNC(purdate) >= TRUNC(SYSDATE) - 7	
	</select>
	
	<!-- 한달 순수익 -->
	<select id = "monthlyNetSales" resultType="int">
		select sum(price * quantity) - sum(price * quantity * 0.1) as netSales from OOOO_orderdetail 
			where PRODUCTID like #{companyid} and purchase = 1 and TRUNC(purdate) >= ADD_MONTHS(TRUNC(SYSDATE), -1)
	</select>
	
	<!-- 오늘 수수료 -->
	<select id = "todayFee">
		select sum(price * quantity * 0.1) as Fee from OOOO_orderdetail where PRODUCTID like #{companyid}  
			and purchase = 1  and TRUNC(purdate) = TRUNC(SYSDATE)  
	</select>
	<!-- 일주일 수수료 -->
	<select id = "weeklyFee">
		select sum(price * quantity * 0.1) as Fee from OOOO_orderdetail  where PRODUCTID like #{companyid}  
		and purchase = 1  and TRUNC(purdate) >= TRUNC(SYSDATE) - 7
	</select>
	<!-- 한달 수수료 -->
	<select id = "monthlyFee">
		select sum(price * quantity * 0.1) as Fee from OOOO_orderdetail  where PRODUCTID like #{companyid} 
		and purchase = 1 and TRUNC(purdate) >= ADD_MONTHS(TRUNC(SYSDATE), -1)
	</select>			
</mapper>